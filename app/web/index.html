<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>iptables GUI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: Arial, sans-serif; background: #0f172a; color: #e2e8f0; margin: 0; padding: 2rem; }
  h1 { color: #38bdf8; }
  button { padding: 10px 14px; background: #1e293b; color: white; border: none; border-radius: 6px; cursor: pointer; }
  button:hover { background: #334155; }
  pre { background: #1e293b; padding: 1rem; border-radius: 6px; color: #a5f3fc; }
</style>
</head>
<body>
  <h1>iptables GUI (Phase 5)</h1>
  <p>This GUI helps define your iptables configuration objectives step by step.</p>

  <!-- ========== STEP 2: OBJECTIVE SELECTION PANEL ========== -->
  <section style="margin-top: 2rem; padding: 1rem; background: #1e293b; border-radius: 10px;">
    <h2 style="color: #38bdf8;">1️⃣ Select Firewall Objective</h2>
    <p style="color: #94a3b8;">Choose what you want the firewall to do with packets.</p>

    <label><strong>Main Objective:</strong></label>
    <select id="objective" style="width: 100%; padding: 8px; border-radius: 6px; margin-top: 5px;">
      <option value="">-- Select --</option>
      <option value="filter">Packet Filtering (ACCEPT, DROP, REJECT)</option>
      <option value="translate">Address Translation (SNAT, DNAT, MASQUERADE)</option>
      <option value="log">Logging (Record Packet Info)</option>
    </select>

    <div id="suboptions" style="margin-top: 1rem; display:none;">
      <label><strong>Action/Target:</strong></label>
      <select id="action" style="width: 100%; padding: 8px; border-radius: 6px;">
        <option value="">-- Select an action --</option>
      </select>
    </div>

    <button id="submitObjective" style="margin-top: 1rem; background: #334155; color: white; border: none; border-radius: 6px; padding: 10px 16px; cursor: pointer;">
      Submit Objective
    </button>

    <pre id="objectiveResult" style="background:#0f172a; padding:10px; border-radius:8px; margin-top:1rem;">{}</pre>
  </section>

  <script>
  const objectiveSelect = document.getElementById("objective");
  const suboptionsDiv = document.getElementById("suboptions");
  const actionSelect = document.getElementById("action");
  const resultBox = document.getElementById("objectiveResult");

  const optionsMap = {
    filter: ["ACCEPT", "DROP", "REJECT"],
    translate: ["SNAT", "DNAT", "MASQUERADE"],
    log: ["LOG", "ULOG"]
  };

  objectiveSelect.addEventListener("change", () => {
    const selected = objectiveSelect.value;
    actionSelect.innerHTML = "";
    if (!selected) {
      suboptionsDiv.style.display = "none";
      return;
    }
    suboptionsDiv.style.display = "block";
    optionsMap[selected].forEach(opt => {
      const o = document.createElement("option");
      o.value = opt.toLowerCase();
      o.textContent = opt;
      actionSelect.appendChild(o);
    });
  });

  document.getElementById("submitObjective").addEventListener("click", async () => {
    const data = {
      objective: objectiveSelect.value,
      action: actionSelect.value
    };
    const res = await fetch("/api/objective", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    });
    const json = await res.json();
    resultBox.textContent = JSON.stringify(json, null, 2);
  });
  </script>

<!-- ========== STEP 3: PACKET IDENTIFICATION PANEL ========== -->
<section style="margin-top: 2rem; padding: 1rem; background: #1e293b; border-radius: 10px;">
  <h2 style="color: #38bdf8;">2️⃣ Define Packet Identification</h2>
  <p style="color: #94a3b8;">Specify the characteristics of packets you want the firewall to match.</p>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
    <div>
      <label><strong>Source IP:</strong></label><br>
      <input id="src_ip" type="text" placeholder="192.168.1.10" style="width:100%; padding:8px; border-radius:6px;">
    </div>

    <div>
      <label><strong>Destination IP:</strong></label><br>
      <input id="dst_ip" type="text" placeholder="192.168.1.100" style="width:100%; padding:8px; border-radius:6px;">
    </div>

    <div>
      <label><strong>Protocol:</strong></label><br>
      <select id="protocol" style="width:100%; padding:8px; border-radius:6px;">
        <option value="">-- Select --</option>
        <option value="tcp">TCP</option>
        <option value="udp">UDP</option>
        <option value="icmp">ICMP</option>
      </select>
    </div>

    <div>
      <label><strong>Source Port:</strong></label><br>
      <input id="src_port" type="number" placeholder="1024" min="1" max="65535" style="width:100%; padding:8px; border-radius:6px;">
    </div>

    <div>
      <label><strong>Destination Port:</strong></label><br>
      <input id="dst_port" type="number" placeholder="80" min="1" max="65535" style="width:100%; padding:8px; border-radius:6px;">
    </div>
  </div>

  <button id="packetSubmit" style="margin-top: 1rem; background: #334155; color: white; border: none; border-radius: 6px; padding: 10px 16px; cursor: pointer;">
    Preview Packet Match
  </button>

  <pre id="packetResult" style="background:#0f172a; padding:10px; border-radius:8px; margin-top:1rem;">{}</pre>
</section>

<script>
// ========== PACKET IDENTIFICATION LOGIC ==========
function validateIP(ip) {
  return /^((25[0-5]|2[0-4]\d|[0-1]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[0-1]?\d\d?)$/.test(ip);
}

document.getElementById("packetSubmit").addEventListener("click", () => {
  const src_ip = document.getElementById("src_ip").value.trim();
  const dst_ip = document.getElementById("dst_ip").value.trim();
  const protocol = document.getElementById("protocol").value.trim();
  const src_port = document.getElementById("src_port").value.trim();
  const dst_port = document.getElementById("dst_port").value.trim();

  const errors = [];
  if (src_ip && !validateIP(src_ip)) errors.push("Invalid Source IP");
  if (dst_ip && !validateIP(dst_ip)) errors.push("Invalid Destination IP");
  if (src_port && (src_port < 1 || src_port > 65535)) errors.push("Invalid Source Port");
  if (dst_port && (dst_port < 1 || dst_port > 65535)) errors.push("Invalid Destination Port");

  const result = {
    src_ip,
    dst_ip,
    protocol,
    src_port: src_port ? parseInt(src_port) : null,
    dst_port: dst_port ? parseInt(dst_port) : null,
    valid: errors.length === 0,
    errors
  };

  document.getElementById("packetResult").textContent = JSON.stringify(result, null, 2);
});
</script>

</body>

</html>
